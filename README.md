# البيت السوداني - منصة الخدمات والتجارة

منصة شاملة تجمع السودانيين في الخليج والعالم، تقدم خدمات التجارة الإلكترونية، دليل الشركات، الوظائف، والخدمات المختلفة.

## المميزات الرئيسية

- 🛍️ **السوق التجاري**: منصة لبيع وشراء المنتجات
- 🏢 **دليل الشركات**: قاعدة بيانات شاملة للشركات السودانية
- 💼 **لوحة الوظائف**: عرض ومشاركة الفرص الوظيفية
- 🛠️ **الخدمات**: دليل مقدمي الخدمات المختلفة
- 📱 **متوافق مع الجوال**: تطبيق ويب متجاوب ودعم للتطبيقات الجوال
- 🌐 **متعدد اللغات**: دعم اللغة العربية والإنجليزية

## 🔧 التقنيات المستخدمة

- **Frontend**: React 18 + TypeScript + Vite
- **UI Framework**: TailwindCSS + Radix UI
- **Backend**: Node.js + Express
- **Database**: Prisma + PostgreSQL
- **Deployment**: Netlify + Fly.io

---

# 🖥️ دليل إدارة خوادم الـ API

## نظرة عامة

يوفر النظام إمكانية ربط التطبيق بخوادم APIs خارجية مختلفة، مما يسمح بالتبديل بسهولة بين بيئات التطوير، الاختبار، والإنتاج.

## 📍 الوصول لإدارة الخوادم

1. **سجل دخول كمدير** للتطبيق
2. اذهب إلى **لوحة التحكم** → **الإعدادات**
3. اختر تبويبة **"الخوادم"**

## 📊 فهم لوحة الإحصائيات

في أعلى صفحة إدارة الخوادم، ستجد 4 مؤشرات مهمة:

| المؤشر             | الوصف                                    |
| ------------------ | ---------------------------------------- |
| **إجمالي الخوادم** | العدد الكلي للخوادم المُعرَّفة في النظام |
| **نشطة**           | عدد الخوادم المتاحة للاستخدام            |
| **غير نشطة**       | عدد الخوادم المُوقفة مؤقتاً              |
| **الخادم الحالي**  | اسم الخادم المُستخدم حالياً              |

## ➕ إضافة ��ادم جديد

### الخطوات:

1. اضغط على **"إضافة خادم جديد"**
2. املأ النموذج بالمعلومات المطلوبة
3. اضغط **"إضافة الخادم"**

### الحقول المطلوبة:

#### المعلومات الأساسية:

- **اسم الخادم**: اسم وصفي للخادم (مثل: "خادم الإنتاج الرئيسي")
- **رابط الخادم**: URL كامل للخادم (مثل: `https://api.production.com`)
- **الوصف**: وصف اختياري لتوضيح استخدام الخادم

#### الإعدادات:

- **خادم نشط**: فعّل لجعل الخادم قابلاً للاستخدام
- **الخادم الافتراضي**: فعّل لجعله الخادم الافتراضي عند بدء التطبيق

### مثال عملي:

```
اسم الخادم: خادم الإنتاج الرئيسي
رابط الخادم: https://api.mycompany.com
الوصف: خادم قاعدة البيانات الرئيسية للموقع
خادم نشط: ✅
الخادم الافتراضي: ❌
```

## ⚙️ الإعدادات المتقدمة

### نقاط النهاية (Endpoints)

يمكن تخصيص روابط مختلفة لكل خدمة:

| الخدمة      | نقطة النهاية الافتراضية | الوصف                  |
| ----------- | ----------------------- | ---------------------- |
| `auth`      | `/auth`                 | المصادقة وتسجيل الدخول |
| `users`     | `/users`                | إدارة المستخدمين       |
| `stores`    | `/stores`               | إدارة المتاجر          |
| `products`  | `/products`             | إدارة المنتجات         |
| `companies` | `/companies`            | دليل الشركات           |
| `jobs`      | `/jobs`                 | لوحة الوظائف           |
| `orders`    | `/orders`               | إدارة الطلبات          |
| `analytics` | `/analytics`            | التحليلات والإحصائيات  |

### أنواع المصادقة

#### 1. Bearer Token (الأكثر شيوعاً)

- يستخدم token المستخدم الحالي
- مناسب لمعظم APIs الحديثة
- يُرسل في header: `Authorization: Bearer <token>`

#### 2. API Key

- مفتاح ثابت للوصول للAPI
- يتم إرساله في header مخصص
- مناسب للخوادم التي تتطلب مفاتيح ثابتة

#### 3. Basic Authentication

- مصادقة أساسية باستخدام username/password
- أقل أماناً من الطرق الأخرى

### إعدادات الأداء

- **Timeout**: مهلة انتظار الاستجابة (افتراضي: 10 ثواني)
- **Retries**: عدد محاولات إعادة الإرسال عند الفشل (افتراضي: 3)
- **Rate Limiting**: تحديد عد�� الطلبات في الدقيقة

## 🔄 إدارة الخوادم الموجودة

### عرض معلومات الخادم

كل خادم يعرض:

- **اسم الخادم** مع العلامات (افتراضي، الحالي، نشط)
- **رابط الخادم**
- **الوصف** (إن وُجد)
- **أزرار الإدارة**

### العلامات والحالات:

| العلامة     | المعنى                           |
| ----------- | -------------------------------- |
| **افتراضي** | الخادم الافتراضي عند بدء التطبيق |
| **الحالي**  | الخادم المُستخدم حالياً          |
| **نشط**     | الخادم متاح للاستخدام            |
| **غير نشط** | الخادم مُوقف مؤقتاً              |

### الإجراءات المتاحة:

#### 🧪 اختبار الاتصال

1. اضغط **"اختبار"** بجانب أي خادم
2. ستظهر النتيجة فوراً:
   - ✅ **نجح الاتصال**: مع وقت الاستجابة بالميلي ثانية
   - ❌ **فشل الاتصال**: مع سبب الخطأ

#### 🔄 تفعيل خادم

1. اضغط **"تفعيل"** بجانب الخادم المطلوب
2. سيصبح هذا الخادم هو المُستخدم فوراً
3. ستظهر علامة "الحالي" عليه
4. سيتحدث مؤشر الحالة

#### ✏️ تعديل الخادم

1. اضغط أيقونة **التعديل** (قلم)
2. سيفتح نموذج التعديل مع البيانات الحالية
3. عدّل المطلوب واضغط **"حفظ التعديل"**

#### 🗑️ حذف الخادم

1. اضغط أيقونة **الحذف** (سلة المهملات)
2. ستظهر رسالة تأكيد
3. **ملاحظة**: لا يمكن حذف الخادم الافتراضي الوحيد

## 📊 مؤشر حالة الاتصال

### موقع المؤشر

- **في إعدادات المدير**: أعلى الصفحة بجانب أزرار الحفظ
- **في الصفحات الأخرى**: شريط الحالة

### ألوان ومعاني المؤشر:

| اللون        | الحالة       | المعنى                    |
| ------------ | ------------ | ------------------------- |
| 🟢 **أخضر**  | متصل         | الاتصال بالخادم ناجح      |
| 🔴 **أحمر**  | غير متصل     | فشل الاتصال بالخادم       |
| 🔷 **أزرق**  | جاري الفحص   | يتم اختبار الاتصال حالياً |
| ⚪ **رمادي** | لم يتم الفحص | لم يتم اختبار الاتصال بعد |

### معلومات المؤشر التفصيلية:

عند النقر على المؤشر أو تمرير الماوس عليه:

- **نوع الخادم**: محلي أم خارجي
- **اسم ا��خادم النشط**
- **رابط الخادم**
- **وقت الاستجابة** (إن توفر)
- **وقت آخر فحص**

## 💾 إدارة البيانات

### تصدير الإعدادات

1. اضغط **"تصدير الإعدادات"**
2. سيتم تنزيل ملف JSON يحتوي على:
   - جميع إعدادات الخوادم
   - معلومات المصادقة (بدون كلمات المرور)
   - التاريخ والوقت
3. **احتفظ بنسخة احتياطية** من هذا الملف

### استيراد الإعدادات

1. اضغط **"استيراد الإعدادات"**
2. اختر ملف JSON مُصدَّر مسبقاً
3. ستتم إضافة الخوادم الجديدة للقائمة الحالية
4. **لن يتم حذف** الخوادم الموجودة

### إعادة تعيين للافتراضي

1. اضغط **"إعادة تعيين"**
2. ستظهر رسالة تحذير
3. ستتم إزالة جميع الخوادم المخصصة
4. سيبقى فقط الخادم المحلي الافتراضي

⚠️ **تحذير**: ستفقد جميع الإعدادات المخصصة نهائياً!

## 🚀 أمثلة عملية للاستخدام

### المثال الأول: إعداد خادم الإنتاج

1. **إضافة الخادم:**

   ```
   ��سم الخادم: خادم الإنتاج الرئيسي
   رابط الخادم: https://api.production-site.com
   الوصف: خادم قاعدة البيانات الرئيسية للموقع
   نشط: ✅
   افتراضي: ❌
   ```

2. **اختبار الاتصال** للتأكد من عمله

3. **تعديل إعدادات المصادقة** إذا لزم الأمر

4. **تفعيل الخادم** ليصبح النشط

5. **مراقبة مؤشر الحالة** للتأكد من استقرار الاتصال

### المثال الثاني: إعداد خادم الاختبار

```
اسم الخادم: خادم الاختبار
رابط الخادم: https://staging-api.mysite.com
الوصف: خادم بيئة الاختبار للمطورين
نشط: ✅
افتراضي: ❌

إعدادات المصادقة:
نوع: API Key
Header: X-API-KEY
القيمة: staging-api-key-123
```

### المثال الثالث: خادم التطوير المحلي

```
اسم الخادم: خادم التطوير المحلي
رابط الخادم: http://localhost:3000/api
الوصف: خادم التطوير على الجهاز المحلي
نشط: ✅
افتراضي: ✅
```

## 🔧 استكشاف الأخطاء وحلها

### مشاكل شائعة وحلولها:

#### ❌ "فشل الاتصال بالخادم"

**الأسباب المحتملة:**

- رابط الخادم غير صحيح
- الخادم غير متاح أو مُوقف
- مشكلة في الشبكة أو الإنترنت
- إعدادات الحماية (CORS) تمنع الاتصال

**الحلول:**

1. تحقق من صحة رابط الخادم
2. اختبر الخادم من متصفح آخر
3. تأكد من تشغيل الخادم
4. راجع إعدادات الحماية

#### ❌ "خطأ في المصادقة"

**الأسباب المحتملة:**

- Token منتهي الصلاحية
- API Key غير صحيح
- إعدادات المصادقة خاطئة

**الحلول:**

1. راجع إعدادات المصادقة
2. تحديث Token أو API Key
3. تحقق من نوع المصادقة المطلوب

#### ⏱️ "انتهت مهلة الاتصال"

**الأسباب المحتملة:**

- الخادم بطيء في الاستجابة
- مهلة الانتظار قصيرة جداً
- مشكلة في الشبكة

**الحلول:**

1. زيادة مهلة الانتظار (Timeout)
2. اختبار الخادم في أوقات مختلفة
3. التحقق من حالة الشبكة

### نصائح للحصول على أفضل أداء:

1. **استخدم خوادم قريبة جغرافياً** لتقليل زمن الاستجابة
2. **اضبط مهلة انتظار مناسبة** (عادة 10-30 ثانية)
3. **راقب مؤشر الحالة** لاكتشاف المشاكل مبكراً
4. **احتفظ بنسخة احتياطية** من إعدادات الخوادم
5. **اختبر الخوادم دورياً** للتأكد من عملها

## 🔐 اعتبارات الأمان

### حماية البيانات:

- لا تشارك إعدادات تحتوي على API Keys حساسة
- استخدم HTTPS دائماً للخوادم الخارجية
- قم بتحديث API Keys دورياً
- راجع صلاحيات الوصول للخوادم

### أفضل الممارسات:

1. **استخدم خوادم منفصلة** لبيئات التطوير والإنتاج
2. **اختبر الخوادم** قبل تفعيلها في الإنتاج
3. **راقب الأنشطة** وسجلات الوصول
4. **احتفظ بنسخ احتياطية** من الإعدادات المهمة

---

## 🛠️ للمطورين

### الملفات الأساسية:

```
client/lib/apiConfig.ts          # مدير إعدادات API
client/lib/apiService.ts         # خدمة API المحدثة
client/hooks/use-api-config.tsx  # React hooks
client/components/ApiConnectionStatus.tsx # مؤشر الحالة
client/pages/admin/Settings.tsx # واجهة الإدارة
```

### الاستخدام البرمجي:

```typescript
import { apiConfigManager } from "@/lib/apiConfig";
import { ApiService } from "@/lib/apiService";

// الحصول على الخادم النشط
const activeConfig = apiConfigManager.getActiveConfig();

// تفعيل خادم خارجي
ApiService.enableExternalApi();

// اختبار الاتصال
const result = await ApiService.testConnection();
```

## 📞 الدعم والمساعدة

إذا واجهت أي مشاكل في استخدام نظام إدارة الخوادم:

1. **تحقق من الدليل أعلاه** للحلول الشائعة
2. **راجع مؤشر حالة الاتصال** للمعلومات التفصيلية
3. **افحص console المتصفح** للأخطاء التقنية
4. **اختبر الخوادم** من أدوات خارجية مثل Postman
5. **راجع سجلات الخادم** للأخطاء من الجانب الآخر

---

## 📄 الترخيص

هذا المشروع مُرخص تحت [MIT License](LICENSE).

## 🤝 المساهمة

نرحب بالمساهمات! يرجى قراءة [دليل المساهمة](CONTRIBUTING.md) للمزيد من التفاصيل.

---

**© 2024 البيت السوداني - جميع الحقوق محفوظة**
