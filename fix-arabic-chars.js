const fs = require('fs');
const path = require('path');

// القاموس لإصلاح الأحرف المعطوبة
const corrections = {
  '��': '',
  'ï»¿': '',
  // إصلاحات محددة للكلمات الشائعة
  'مرحباً بكم في البيت السوداني': 'مرحباً بكم في البيت السوداني',
  'الخدمات المهنية': 'الخدمات المهنية',
  'الوضع الليلي': 'الوضع الليلي',
  'متاجر نشطة': 'متاجر نشطة',
  'تواصل مع الشركات': 'تواصل مع الشركات',
  'عرض التقارير التفصيلية': 'عرض التقارير التفصيلية',
  'صلاحيات وإعدادات الأمان': 'صلاحيات وإعدادات الأمان',
  'هل أنت متأكد من اعتماد هذا المتجر؟': 'هل أنت متأكد من اعتماد هذا المتجر؟',
  'السودانية في الخليج والعالم': 'السودانية في الخليج والعالم',
  'زبدة الشيا السودانية': 'زبدة الشيا السودانية',
  'حدث خطأ في حفظ المنتج': 'حدث خطأ في حفظ المنتج',
  'تحديد إذا كان التاجر جديد بناءً على تاريخ إنشاء الحساب': 'تحديد إذا كان التاجر جديد بناءً على تاريخ إنشاء الحساب',
  'خطأ في جلب بيانات المتجر': 'خطأ في جلب بيانات المتجر',
  'مرحباً بك في متجرك الجديد': 'مرحباً بك في متجرك الجديد',
  'للتجار الجدد': 'للتجار الجدد',
  'يرجى اختيار ملف صورة صالح': 'يرجى اختيار ملف صورة صالح',
  'التحقق من حجم الملف': 'التحقق من حجم الملف',
  'يرجى إدخال رقم الهاتف': 'يرجى إدخال رقم الهاتف',
  'رأس الخيمة': 'رأس الخيمة',
  'السودان': 'السودان',
  'السعر: من الأقل': 'السعر: من الأقل',
  'انضم إلى آلاف السودانيين': 'انضم إلى آلاف السودانيين',
  'طبخ منزلي': 'طبخ منزلي',
  'كلمة المرور': 'كلمة المرور',
  'حدث خطأ أثناء إنشاء النسخة الاحتياطية': 'حدث خطأ أثناء إنشاء النسخة الاحتياطية',
  'رسالة الصيانة': 'رسالة الصيانة',
  'معلومات شاملة عن المتجر': 'معلومات شاملة عن المتجر',
  'المتاجر النشطة': 'المتاجر النشطة',
  'رقم الهاتف': 'رقم الهاتف',
  'رفع صورة جديدة': 'رفع صورة جديدة',
  'الشروط والأحكام': 'الشروط والأحكام',
  'إعدادات التطبيق الحالية': 'إعدادات التطبيق الحالية',
  'يرجى إدخال البريد الإلكتروني': 'يرجى إدخال البريد الإلكتروني',
  'أزياء وملابس': 'أزياء وملابس',
  'مميز': 'مميز',
  'إلغاء': 'إلغاء',
  'محاكاة مزامنة البيانات': 'محاكاة مزامنة البيانات',
  'هنا يكون QR Code': 'هنا يكون QR Code',
  'مرحباً بكم في البيت السوداني': 'مرحباً بكم في البيت السوداني',
  '© 2024 البيت السوداني': '© 2024 البيت السوداني'
};

// دالة لإصلاح النص
function fixArabicText(content) {
  let fixed = content;
  
  // إزالة الأحرف المعطوبة
  fixed = fixed.replace(/��/g, '');
  fixed = fixed.replace(/ï»¿/g, '');
  
  // تطبيق الإصلاحات المحددة
  Object.entries(corrections).forEach(([broken, correct]) => {
    if (broken !== correct) {
      const regex = new RegExp(broken.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
      fixed = fixed.replace(regex, correct);
    }
  });
  
  return fixed;
}

// دالة لمعالجة ملف واحد
function processFile(filePath) {
  try {
    const content = fs.readFileSync(filePath, 'utf8');
    const fixed = fixArabicText(content);
    
    if (content !== fixed) {
      fs.writeFileSync(filePath, fixed, 'utf8');
      console.log(`✅ تم إصلاح: ${filePath}`);
      return true;
    }
    return false;
  } catch (error) {
    console.error(`❌ خطأ في معالجة ${filePath}:`, error.message);
    return false;
  }
}

// دالة لمعالجة مجلد
function processDirectory(dirPath) {
  const items = fs.readdirSync(dirPath);
  let fixedCount = 0;
  
  for (const item of items) {
    const fullPath = path.join(dirPath, item);
    const stat = fs.statSync(fullPath);
    
    if (stat.isDirectory() && !item.startsWith('.') && item !== 'node_modules') {
      fixedCount += processDirectory(fullPath);
    } else if (stat.isFile() && (item.endsWith('.tsx') || item.endsWith('.ts') || item.endsWith('.js'))) {
      if (processFile(fullPath)) {
        fixedCount++;
      }
    }
  }
  
  return fixedCount;
}

// تشغيل الإصلاح
console.log('🚀 بدء إصلاح الأحرف العربية المعطوبة...');
const fixedFiles = processDirectory('./client');
console.log(`✨ تم الانتهاء! تم إصلاح ${fixedFiles} ملف.`);
